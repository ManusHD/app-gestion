<button (click)="mostrarDetalles()" class="">
  <span class="material-icons">email</span>
</button>

<div *ngIf="mostrarModal" class="modal">
  <div class="modal-content">
    <div class="modal-header-custom">
      <span class="close"
        [appConfirm]="'VAS A SALIR SIN ENVIAR EL CORREO ¿ESTÁS SEGURO?'"
        (confirmed)="cerrarModal()">&times;
      </span>
    </div>

    <div class="modal-body">
      <form [formGroup]="formCorreo" class="correo-form">

        <!-- Selector de Plantilla -->
        <div class="form-group">
          <label for="plantilla">Plantilla (Opcional)</label>
          <select id="plantilla" formControlName="plantillaId" (change)="onPlantillaChange()">
            <option [value]="null">Sin plantilla</option>
            <option *ngFor="let plantilla of plantillas" [value]="plantilla.id">
              {{ plantilla.alias }}
            </option>
          </select>
        </div>

        <!-- Destinatario -->
        <div class="form-group">
          <label for="destinatario">Destinatario</label>
          <div class="input-icon">
            <span class="material-icons">person</span>
            <input id="destinatario" type="email" formControlName="destinatario" readonly />
          </div>
        </div>

        <!-- Asunto -->
        <div class="form-group">
          <label for="asunto">Asunto</label>
          <div class="input-icon">
            <span class="material-icons">subject</span>
            <input id="asunto" type="text" formControlName="asunto" />
          </div>
        </div>

        <!-- Cuerpo del correo -->
        <div class="form-group">
          <label for="cuerpo">Cuerpo del correo</label>
          <textarea id="cuerpo" rows="12" formControlName="cuerpo"
            placeholder="Contenido del correo (puede usar HTML)"></textarea>
        </div>

        <!-- Gestión de imágenes -->
        <div class="imagenes-section">
          <h3>Imágenes adicionales</h3>
          <button type="button" class="btn-secundario" (click)="agregarImagenUrl()">
            <span class="material-icons">add_photo_alternate</span>
            Agregar Imagen (URL)
          </button>

          <div class="lista-imagenes" *ngIf="imagenesUrls.length > 0">
            <div class="imagen-item" *ngFor="let url of imagenesUrls; let i = index">
              <img [src]="url" alt="Imagen" class="preview-img" />
              <span class="url-text">{{ url }}</span>
              <button type="button" class="btn-icono eliminar" (click)="eliminarImagen(i)">
                <span class="material-icons">delete</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Variables disponibles -->
        <div class="variables-info">
          <details>
            <summary>Variables disponibles</summary>
            <div class="variables-list">
              <p><code>&#123;nombreColaborador&#125;</code> - Nombre del colaborador/destino</p>
              <p><code>&#123;direccion&#125;</code> - Dirección de envío</p>
              <p><code>&#123;poblacion&#125;</code> - Población</p>
              <p><code>&#123;provincia&#125;</code> - Provincia</p>
              <p><code>&#123;cp&#125;</code> - Código postal</p>
              <p><code>&#123;telefono&#125;</code> - Teléfono</p>
              <p><code>&#123;fechaEnvio&#125;</code> - Fecha de envío</p>
              <p><code>&#123;productos&#125;</code> - Lista de productos</p>
            </div>
          </details>
        </div>
      </form>

      <!-- Vista previa -->
      <div class="vista-previa-section" *ngIf="mostrarVistaPrevia">
        <h3>Vista Previa</h3>
        <div class="preview-container" [innerHTML]="formCorreo.get('cuerpo')?.value"></div>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-secundario" (click)="toggleVistaPrevia()">
        <span class="material-icons">
          {{ mostrarVistaPrevia ? 'visibility_off' : 'visibility' }}
        </span>
        {{ mostrarVistaPrevia ? 'Ocultar' : 'Ver' }} Vista Previa
      </button>

      <button class="btn-principal" (click)="enviarCorreo()" [disabled]="formCorreo.invalid">
        <span class="material-icons">send</span>
        Enviar Correo
      </button>
    </div>
  </div>
</div>
